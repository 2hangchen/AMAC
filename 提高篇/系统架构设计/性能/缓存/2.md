# 如何选择缓存的读写策略
我们主要关注三个问题
- 脏数据（关于数据相对一致性的问题）
- 命中率问题
- 性能（读写性能）

这三个问题是选择缓存读写的关键核心问题。

场景：

a更新数据库的时候，将数据库从20+1等于21，这个时候b更新数据库将21+改成了22，然后a开始更新缓存，这个时候缓存是21，那么
这样就造成了数据不一致的情况。

## 旁路缓存


```go
//读
有缓存就返回，没有就读数据库，然后更新缓存

// 写
更新数据库
删除缓存。

其实就是说管理原的那个更新缓存的操作取消了，改成删除了。一切以数据库为主。这样就不会造成上述的问题了。

```

## 分布式锁

我们这里不删除，还是更新，我们只需要在更新缓存的时候也加锁，这样缓存就只能由一个管理员操作了。当然还是会有问题
就是当用户读了缓存，然后管理员还未更新的时候。所以重要数据，还是需要在此确认数据库的。

## 写回策略

这个策略就是直接操作缓存，然后将数据标记为脏，结束，

读取的时候看有缓存没，有就返回，没有就看有没有脏数据，有的话就将数据写入db，并且更新缓存的脏为不脏。这不就大大的提高了写入的效率吗，当然了 脏的这个信息是写入到内存中的，假如你断电了，就丢数据了，所以要时不时的就定时将脏数据写入db中。
