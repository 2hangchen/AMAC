# 系统架构安全性
- 认证 ：系统分辨出真正的用户
- 授权 ：系统控制一个用户应该看到什么内容
- 凭证 ：系统保证用户以及另一个被授权的对象，当时的承诺是真实可靠不可动摇的
- 保密 ：系统保证信息不被内部包括管理员在内的人获取
- 传输 ：系统保证信息在传输过程中，不被他人获取
- 验证 ：系统保证输入到系统中的信息都是不会对系统的稳定性和统一性产生影响

## 认证
- ssl/tls 传输安全层的认证

- http认证 建立连接的认证

  基本原理是：客户端向服务器发送请求，服务器作出响应，并且返回401，`WWW-Authenticate:`这个字段表示服务器要让客户端应答的证明途径是什么， 客户端收到401的响应后，发现服务器要证明，那么客户端通过 authorization: 字段将证明发送给服务器，如果服务器证明身份就返回200 否则就返回 403 访问阻止，下面是在服务器响应 401，客户端要发送证明的时候的几种手段 

  - digest ：这种方法就是将用户的密码+盐和用户名，hash计算以后传入服务器端存储起来
  
  - bearer ：OAuth 2的技术
  
  - hoba ：是一种基于自签名证书的认证方案

  - aws4-hmac-sha256 亚马逊的解决方案
  - ntlm/negotiate 微软解决方案
  - windows live id 微软解决方案
  - Twitter basic twitter的解决方案
- web认证 对于来访用户的认证
  > oauth 2.0 和 WebAuthn[关系](https://oauth.net/webauthn/)
  - WebAuthn

  注册的过程：

  用户在系统的注册界面填写好数据后，点击注册信息，服务器暂时保存这些数据，并生成器一个challenge（一个随机的字符串）和用户id返回给客户端，客户端的webauthn API接收到这两个数据后，将其传递给验证器，验证器是客户端可验证的API接口，比如你的指纹，faceid等屋里验证的统一接口，验证器提示用户进行验证（比如让你验证指纹）验证的结果会生成一个私钥和公钥，验证器存储私钥和用户信息以及当前的域名，用私钥对challenge进行签名，将这个签名结果，userid，以及公钥一起返回给客户端，客户端再将数据转发给服务器，服务器会检查userid，并用公钥 解密后的结果出来的challenge和之前的challenge进行验证，如果通过，服务端会存储userid和公钥


  登陆的过程：

  用户填写用户名即可点击登陆，服务器返回一个随机challenge和userid，浏览器将challenge和userid转发给验证器，验证器提示用户进行认证操作，如果验证器已经有了注册时候的私钥，如果域名和用户都对的话，就不会再生成一个新的私钥对了，直接以存储的私钥加密challenge，并且返回给浏览器，浏览器转发给服务器，服务器接收到这个被加密的challenge后，用公钥进行解密，发现就是之前发送的那个challenge，宣布此次登陆有效。

- 认证的实现

## 授权
授权的两个要素1 确保授权的过程可靠 2 确保授权的结果可控

- RBAC
  - 用户
  - 角色
  - 许可
  - 资源
  
  `用户`隶属于`角色`拥有`许可`去操纵`资源`

  - 最小特权原则：角色拥有的权限是根据完成某个任务所需的最小权限来赋予的，比如你的电脑拥有管理员权限和普通权限，当你需要完成的任务不需要管理员权限的时候你
  只需要普通权限即可，如果需要更高权限就申请管理员权限。

  - 角色关联 ： 在rbac中可以对不同的角色权限进行继承，比如，全体员工拥有吃饭的权利，普通工程师拥有提交代码的权利，技术总监拥有开会的权利，那么我们可以这么来分配，给全体员工分配吃饭权利，普通工程师继承这个权利并且加上提交代码的权利，技术总计继承普通工程师的权利并且再加上开会的权利

  - 角色之间的互斥：比如不能让一个角色既拥有出纳的权利又同时拥有财务的权利，互斥也可以是限定某个角色拥有的权限数量，比如不能让一个人拥有从产品需求到代码设计，代码实现，代码测试，后期的维护这全部的权限。

  - 垂直权限 ： 功能权限，xx角色拥有某个功能就是属于垂直权限
  
  - 水平权限 ： 数据权限

  垂直权限可以进行抽象，抽象的某个模型很多用户都可以使用，例如可以很多人拥有一种功能，但是水平权限，因为即便是同样的角色，拥有的数据也不同，因此数据是不能抽象的，需要单独管理


- OAuth2
从原理来说oauth2主要解决对于第三方授权的作用，比如你微信登陆，然后授权给某个app，就是这么个作用。

oauth2的核心就是使用`令牌`去代替容易被泄漏的`密码`


## 凭证
- cookie & session
- JWT
## 保密
- 保密的强度
- 客户端加密
- 密码存储和验证
## 传输
- 摘要，加密和签名
- 数字证书
- 传输安全层
## 验证